<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.21.1/cytoscape.min.js" integrity="sha512-H44mkyNG9R5Y8NDjFoZ0lnMGgxfsbfbuewUNJJjecVOUzR3n/JL8+UFc07pP74T5tA+aGOMKCwazdDYwoquE8g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="./js/inputs/processors/textProcessor.js"></script>
  <script src="./js/inputs/model.js"></script>
  <script src="./js/helpers/graphColorHelper.js"></script>
  <script src="./js/algorithms/bfs.js"></script>
  <script src="./js/helpers/stepsExporter.js"></script>
  <script src="./js/helpers/step.js"></script>
  
<style>
    #cy {
  height: 100%;
}
</style>
</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark justify-content-center">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"><h3>Graph Algorithms in JavaScript</h3></a>
        <!--- 2 links to the right of navbar -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="index.html">Text Input</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="draw.html">Draw</a>
            </li>
    
    </div>
</nav>

<div class="row" style="height: 100vh;">
    <div class="col-sm-4 bg-dark" style="padding-left: 1%;">
        <h4 class="text-white lead"> Here You may fill in data and Run Algorithms on it.</h1><br>
            <div class="row">
                <div class="col">
                  <input type="number" class="form-control" placeholder="No of Vertices" name="vertices" id="vertices">
                </div>
                <div class="col">
                  <input type="number" class="form-control" placeholder="No of Edges" name="edges" id="edges">
                </div>
              </div>
            <div class="mb-3">
                <label for="graphInputText" class="form-label">Enter </label>
                <textarea class="form-control" rows="5" id="graphInputText" name="graphInputText"></textarea>
              </div>
            <button class="btn btn-primary" onclick="onSubmitButton()">Generate Graph</button>
            <div class="mb-3" id="algorithmDiv">
              <label for="selectAlgorithm" class="form-label">Select a Graph Algorithm to Run</label>
              <select class="form-select" id="selectAlgorithm">
                <option>BFS</option>
                <option>DFS</option>
                <option>Prims</option>
                <option>Kruskal</option>
              </select><br>
              <select class="form-select" id="selectStartNode">
              </select><br>
              <select class="form-select" id="selectEndNode">
              </select><br>
              <button class="btn btn-primary" onclick="runAlgorithm()" id="runAlgorithmButton">Run Algorithm</button> <br> <br>
              <button class="btn btn-primary" onclick="colorGraphOnceForward()" id="runAlgorithmButton">Next Step</button> <br><br>
              <button class="btn btn-primary" onclick="colorGraphOnceBackward()" id="runAlgorithmButton">Previous Step</button> <br><br>
            </div>
      

    </div>
    <div class="col-sm-8" id="cy">Canvas</div>
  </div>
  <script>
//initialize cytoscape
let cy = window.cy = cytoscape({
        container: document.getElementById('cy'),
        elements: {
          nodes: [],
          edges: []
        },
        style: [
          {
            selector: 'node',
            style: {
              'background-color': '#666',
              'label': 'data(id)'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 3,
              'line-color': '#ccc',
              'target-arrow-color': '#ccc',
              'target-arrow-shape': 'triangle'
            }
          }
        ]
      });

//my custom initializer
    document.getElementById("algorithmDiv").style.display = "none";
    const modelInstance = new Model();
    const bfsInstance = new BFS(modelInstance);
    const graphColorHelperInstance = new GraphColorHelper(cy,'#2ecc71', '#2ecc71');
    const stepExporter = new StepsExporter();

    function onSubmitButton(){
      let formData = getFormData();
      let graphConnections = extractGraphConnectionsFromInputTextFormData(formData.graphInputText);
      
          
      for(let i=0;i<graphConnections.length;i++){
        let graphConnection = graphConnections[i];
        let from = graphConnection.from;
        let to = graphConnection.to;
        let weight = graphConnection.weight;
        if (!modelInstance.hasNode(from)) {
          modelInstance.addNode(from);
          console.log('from : '+from);

          cy.add([
            {
              group: 'nodes',
              data: {
                id: from
              }
            }
          ]);
        }

        if (!modelInstance.hasNode(to)) {
          modelInstance.addNode(to);
          console.log('to : '+to);
          cy.add([
            {
              group: 'nodes',
              data: {
                id: to
              }
            }
          ]);
        }
        if(!modelInstance.hasEdge(from,to)){
          modelInstance.addEdge(from,to);
          cy.add({
          group: 'edges',
          data: {
            id: from  + '-'+ to,
            source: from,
            target: to,
            weight: weight
          }
        });
        }
       
      }
      //refresh layout to fit the graph
      cy.layout({
        name: 'breadthfirst',
        fit: true
      }).run();

      //if no errors in generating graph then show the select element and submit button
      //Add Nodes to the select element for start and end
      let nodes = modelInstance.getNodes();
      let selectStartNode = document.getElementById("selectStartNode");
      let selectEndNode = document.getElementById("selectEndNode");
      selectStartNode.innerHTML = "";
      selectEndNode.innerHTML = "";
      for(let i=0;i<nodes.length;i++){
        let node = nodes[i];
        let option = document.createElement("option");
        let option1 = document.createElement("option");
        option.text = node;
        option.value = node;
        option1.text = node;
        option1.value = node;
        selectStartNode.add(option1);
        selectEndNode.add(option);
      }
      document.getElementById("algorithmDiv").style.display = "block";
    }


    function runAlgorithm(){
      let selectedAlgorithm = document.getElementById("selectAlgorithm").value;
      let startNode = document.getElementById("selectStartNode").value;
      let endNode = document.getElementById("selectEndNode").value;
      console.log(startNode,endNode);
      
      if(selectedAlgorithm == "BFS"){
        console.log("BFS");
        bfsInstance.setStartAndEndNode(startNode,endNode);
        let data = bfsInstance.run().data;
        graphColorHelperInstance.setEdges(data[data.length-1].edges);
        console.log(graphColorHelperInstance.edges);
      }
    }

    function colorGraphOnceForward(){
      graphColorHelperInstance.colorGraphOnceForward();
    }

    function colorGraphOnceBackward(){
      graphColorHelperInstance.colorGraphOnceBackward();
    }


  </script>
</body>
</html>